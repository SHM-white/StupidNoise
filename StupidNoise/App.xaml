<Application x:Class="StupidNoise.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:StupidNoise"
             xmlns:tb="http://www.hardcodet.net/taskbar"
             StartupUri="MainWindow.xaml">
    <Application.Resources>
        <ResourceDictionary>
            <!-- Shared view model for bindings across app -->
            <local:AppViewModel x:Key="AppViewModel" />

            <!-- Tray icon using Hardcodet.NotifyIcon.Wpf -->
            <tb:TaskbarIcon x:Key="AppTray"
                           ToolTipText="StupidNoise"
                           IconSource="pack://application:,,,/App.ico">
                <tb:TaskbarIcon.ContextMenu>
                    <ContextMenu>
                        <!-- Bind IsChecked to the shared view model. TwoWay updates both tray and window. -->
                        <MenuItem Header="开关" IsCheckable="True" IsChecked="{Binding IsOn, Source={StaticResource AppViewModel}, Mode=TwoWay}" />
                        <Separator/>
                        <MenuItem Header="退出" Click="ExitMenu_Click"/>
                    </ContextMenu>
                </tb:TaskbarIcon.ContextMenu>
            </tb:TaskbarIcon>
        </ResourceDictionary>
    </Application.Resources>
</Application>
